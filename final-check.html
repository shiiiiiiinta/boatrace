<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>æœ€çµ‚ç¢ºèªãƒ†ã‚¹ãƒˆ</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f5f5f5; }
        .test { background: white; padding: 20px; margin: 20px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .pass { color: green; font-weight: bold; font-size: 18px; }
        .fail { color: red; font-weight: bold; font-size: 18px; }
        table { border-collapse: collapse; width: 100%; margin: 15px 0; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background: #667eea; color: white; }
        .highlight { background: #ffffcc; }
        h1 { color: #333; }
        h2 { color: #667eea; }
    </style>
</head>
<body>
    <h1>ğŸ¯ æœ€çµ‚ç¢ºèªãƒ†ã‚¹ãƒˆ - 3é …ç›®æ¤œè¨¼</h1>
    
    <div class="test">
        <h2>âœ“ æ¤œè¨¼é …ç›®1: ä¸‰å›½12Rã®åˆè¨ˆç¥¨æ•° = 180ç¥¨</h2>
        <div id="check1-status">ç¢ºèªä¸­...</div>
        <div id="check1-table"></div>
    </div>

    <div class="test">
        <h2>âœ“ æ¤œè¨¼é …ç›®2: ä¸‰å›½12Rã®1å·è‰‡ã‚ªãƒƒã‚º = 1.0-1.5</h2>
        <div id="check2-status">ç¢ºèªä¸­...</div>
    </div>

    <div class="test">
        <h2>âœ“ æ¤œè¨¼é …ç›®3: æˆ¸ç”°ãƒ»å¹³å’Œå³¶ã¯éé–‹å‚¬</h2>
        <div id="check3-status">ç¢ºèªä¸­...</div>
    </div>

    <div class="test" id="final-result" style="display:none; background: #e8f5e9;">
        <h2>ğŸ“Š æœ€çµ‚çµæœ</h2>
        <div id="final-message" style="font-size: 24px; padding: 20px;"></div>
    </div>

    <script>
        const API_BASE = 'https://boatrace.shinta7023.workers.dev';
        let check1 = false, check2 = false, check3 = false;

        async function verifyMikuni12R() {
            try {
                const response = await fetch(`${API_BASE}/api/odds/10/12?hd=20260218`);
                const data = await response.json();
                
                if (!data.success || !data.data || !data.data.hasRace || !data.data.odds) {
                    document.getElementById('check1-status').innerHTML = '<div class="fail">âŒ ãƒ‡ãƒ¼ã‚¿å–å¾—å¤±æ•—</div>';
                    document.getElementById('check2-status').innerHTML = '<div class="fail">âŒ ãƒ‡ãƒ¼ã‚¿å–å¾—å¤±æ•—</div>';
                    return;
                }
                
                const odds = data.data.odds;
                const totalTickets = odds.reduce((sum, b) => sum + (b.voteTickets || 0), 0);
                
                // ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤º
                let table = '<table><tr><th>è‰‡ç•ª</th><th>ã‚ªãƒƒã‚ºç¯„å›²</th><th>ç¥¨æ•°</th><th>é‡‘é¡</th></tr>';
                odds.forEach((b, i) => {
                    const highlight = i === 0 ? ' class="highlight"' : '';
                    table += `<tr${highlight}>`;
                    table += `<td>${b.boatNumber}å·è‰‡</td>`;
                    table += `<td>${b.oddsMin}-${b.oddsMax}</td>`;
                    table += `<td>${(b.voteTickets || 0).toLocaleString()}ç¥¨</td>`;
                    table += `<td>${((b.voteAmount || 0) / 10000).toFixed(0)}ä¸‡å††</td>`;
                    table += '</tr>';
                });
                table += `<tr style="background: #f0f0f0; font-weight: bold;"><td colspan="2">åˆè¨ˆ</td><td>${totalTickets}ç¥¨</td><td>-</td></tr>`;
                table += '</table>';
                document.getElementById('check1-table').innerHTML = table;
                
                // Check 1: åˆè¨ˆ180ç¥¨
                if (totalTickets === 180) {
                    document.getElementById('check1-status').innerHTML = 
                        `<div class="pass">âœ… PASS: åˆè¨ˆç¥¨æ•° = ${totalTickets}ç¥¨</div>`;
                    check1 = true;
                } else {
                    document.getElementById('check1-status').innerHTML = 
                        `<div class="fail">âŒ FAIL: åˆè¨ˆç¥¨æ•° = ${totalTickets}ç¥¨ (æœŸå¾…å€¤: 180ç¥¨)</div>`;
                }
                
                // Check 2: 1å·è‰‡ã‚ªãƒƒã‚º 1.0-1.5
                const boat1 = odds[0];
                if (boat1 && boat1.oddsMin === 1.0 && boat1.oddsMax === 1.5) {
                    document.getElementById('check2-status').innerHTML = 
                        `<div class="pass">âœ… PASS: 1å·è‰‡ã‚ªãƒƒã‚º = ${boat1.oddsMin}-${boat1.oddsMax}</div>`;
                    check2 = true;
                } else {
                    document.getElementById('check2-status').innerHTML = 
                        `<div class="fail">âŒ FAIL: 1å·è‰‡ã‚ªãƒƒã‚º = ${boat1.oddsMin}-${boat1.oddsMax} (æœŸå¾…å€¤: 1.0-1.5)</div>`;
                }
                
            } catch (error) {
                document.getElementById('check1-status').innerHTML = `<div class="fail">âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
                document.getElementById('check2-status').innerHTML = `<div class="fail">âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            }
        }

        async function verifyNonRacing() {
            try {
                const toda = await fetch(`${API_BASE}/api/odds/02/1?hd=20260218`).then(r => r.json());
                const heiwa = await fetch(`${API_BASE}/api/odds/04/1?hd=20260218`).then(r => r.json());
                
                const todaOK = toda.success && toda.data && !toda.data.hasRace;
                const heiwaOK = heiwa.success && heiwa.data && !heiwa.data.hasRace;
                
                let status = '<div>';
                status += todaOK ? '<div class="pass">âœ… æˆ¸ç”°: éé–‹å‚¬</div>' : '<div class="fail">âŒ æˆ¸ç”°: é–‹å‚¬ä¸­ã¨åˆ¤å®š</div>';
                status += heiwaOK ? '<div class="pass">âœ… å¹³å’Œå³¶: éé–‹å‚¬</div>' : '<div class="fail">âŒ å¹³å’Œå³¶: é–‹å‚¬ä¸­ã¨åˆ¤å®š</div>';
                status += '</div>';
                
                document.getElementById('check3-status').innerHTML = status;
                
                check3 = todaOK && heiwaOK;
                
            } catch (error) {
                document.getElementById('check3-status').innerHTML = `<div class="fail">âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            }
        }

        async function showFinalResult() {
            const finalDiv = document.getElementById('final-result');
            const finalMsg = document.getElementById('final-message');
            
            finalDiv.style.display = 'block';
            
            if (check1 && check2 && check3) {
                finalDiv.style.background = '#e8f5e9';
                finalMsg.innerHTML = '<div class="pass">ğŸ‰ å…¨é …ç›® PASSï¼<br>æœ¬ç•ªãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«æˆåŠŸã—ã¾ã—ãŸï¼</div>';
            } else {
                finalDiv.style.background = '#ffebee';
                finalMsg.innerHTML = '<div class="fail">âš ï¸ ä¸€éƒ¨ã®é …ç›®ãŒå¤±æ•—ã—ã¾ã—ãŸ<br>è©³ç´°ã¯ä¸Šè¨˜ã‚’ã”ç¢ºèªãã ã•ã„</div>';
            }
        }

        async function runAllTests() {
            await verifyMikuni12R();
            await new Promise(r => setTimeout(r, 2000));
            await verifyNonRacing();
            await new Promise(r => setTimeout(r, 1000));
            await showFinalResult();
        }

        runAllTests();
    </script>
</body>
</html>