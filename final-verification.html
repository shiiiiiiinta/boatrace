<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Final Verification</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #f5f5f5; }
        .result { background: white; padding: 20px; margin: 20px 0; border-radius: 8px; }
        .pass { color: green; font-weight: bold; font-size: 18px; }
        .fail { color: red; font-weight: bold; font-size: 18px; }
        pre { background: #1e1e1e; color: #d4d4d4; padding: 15px; border-radius: 4px; overflow-x: auto; }
        table { border-collapse: collapse; width: 100%; margin: 15px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background: #667eea; color: white; }
    </style>
</head>
<body>
    <h1>ğŸ¯ æœ€çµ‚æ¤œè¨¼ãƒ†ã‚¹ãƒˆ</h1>
    
    <div class="result">
        <h2>Test 1: ä¸‰å›½ï¼ˆ10ï¼‰12R</h2>
        <div id="test1-status">Testing...</div>
        <div id="test1-details"></div>
        <pre id="test1-raw"></pre>
    </div>

    <div class="result">
        <h2>Test 2: æˆ¸ç”°ï¼ˆ02ï¼‰1Rï¼ˆéé–‹å‚¬ç¢ºèªï¼‰</h2>
        <div id="test2-status">Testing...</div>
        <pre id="test2-raw"></pre>
    </div>

    <div class="result">
        <h2>Test 3: å¹³å’Œå³¶ï¼ˆ04ï¼‰1Rï¼ˆéé–‹å‚¬ç¢ºèªï¼‰</h2>
        <div id="test3-status">Testing...</div>
        <pre id="test3-raw"></pre>
    </div>

    <div class="result" id="final-result" style="display:none;">
        <h2>ğŸ‰ æœ€çµ‚çµæœ</h2>
        <div id="final-message"></div>
    </div>

    <script>
        let test1Pass = false;
        let test2Pass = false;
        let test3Pass = false;

        async function test1() {
            try {
                const response = await fetch('https://boatrace.shinta7023.workers.dev/api/odds/10/12?hd=20260218');
                const data = await response.json();
                
                document.getElementById('test1-raw').textContent = JSON.stringify(data, null, 2);
                
                if (!data.success || !data.data || !data.data.hasRace) {
                    document.getElementById('test1-status').innerHTML = '<div class="fail">âŒ FAIL: ãƒ¬ãƒ¼ã‚¹é–‹å‚¬ãªã—ã¾ãŸã¯APIã‚¨ãƒ©ãƒ¼</div>';
                    return;
                }
                
                const odds = data.data.odds;
                const totalTickets = odds.reduce((sum, b) => sum + (b.voteTickets || 0), 0);
                const boat1 = odds[0];
                
                let html = '<table><tr><th>è‰‡ç•ª</th><th>ã‚ªãƒƒã‚ºMin</th><th>ã‚ªãƒƒã‚ºMax</th><th>ç¥¨æ•°</th></tr>';
                odds.forEach(b => {
                    html += `<tr><td>${b.boatNumber}å·è‰‡</td><td>${b.oddsMin || '-'}</td><td>${b.oddsMax || '-'}</td><td>${b.voteTickets || 0}</td></tr>`;
                });
                html += `<tr><th colspan="3">åˆè¨ˆ</th><th>${totalTickets}ç¥¨</th></tr>`;
                html += '</table>';
                
                document.getElementById('test1-details').innerHTML = html;
                
                const check1 = boat1 && boat1.oddsMin === 1.0 && boat1.oddsMax === 1.5;
                const check2 = totalTickets === 180;
                const check3 = odds.length === 6;
                
                let status = '<div>';
                status += check3 ? '<div class="pass">âœ… 6è‰‡ã®ãƒ‡ãƒ¼ã‚¿å–å¾—</div>' : `<div class="fail">âŒ ${odds.length}è‰‡ã®ã¿ï¼ˆæœŸå¾…: 6è‰‡ï¼‰</div>`;
                status += check1 ? '<div class="pass">âœ… 1å·è‰‡ã‚ªãƒƒã‚º 1.0-1.5</div>' : '<div class="fail">âŒ 1å·è‰‡ã‚ªãƒƒã‚ºãŒä¸ä¸€è‡´</div>';
                status += check2 ? '<div class="pass">âœ… åˆè¨ˆ180ç¥¨</div>' : `<div class="fail">âŒ åˆè¨ˆ${totalTickets}ç¥¨ï¼ˆæœŸå¾…: 180ç¥¨ï¼‰</div>`;
                status += '</div>';
                
                document.getElementById('test1-status').innerHTML = status;
                
                test1Pass = check1 && check2 && check3;
                
            } catch (error) {
                document.getElementById('test1-status').innerHTML = `<div class="fail">âŒ ERROR: ${error.message}</div>`;
            }
        }

        async function test2() {
            try {
                const response = await fetch('https://boatrace.shinta7023.workers.dev/api/odds/02/1?hd=20260218');
                const data = await response.json();
                
                document.getElementById('test2-raw').textContent = JSON.stringify(data, null, 2);
                
                if (data.success && data.data && !data.data.hasRace) {
                    document.getElementById('test2-status').innerHTML = '<div class="pass">âœ… PASS: éé–‹å‚¬ã¨ã—ã¦æ­£ã—ãè¡¨ç¤º</div>';
                    test2Pass = true;
                } else {
                    document.getElementById('test2-status').innerHTML = '<div class="fail">âŒ FAIL: é–‹å‚¬ä¸­ã¨èª¤åˆ¤å®š</div>';
                }
                
            } catch (error) {
                document.getElementById('test2-status').innerHTML = `<div class="fail">âŒ ERROR: ${error.message}</div>`;
            }
        }

        async function test3() {
            try {
                const response = await fetch('https://boatrace.shinta7023.workers.dev/api/odds/04/1?hd=20260218');
                const data = await response.json();
                
                document.getElementById('test3-raw').textContent = JSON.stringify(data, null, 2);
                
                if (data.success && data.data && !data.data.hasRace) {
                    document.getElementById('test3-status').innerHTML = '<div class="pass">âœ… PASS: éé–‹å‚¬ã¨ã—ã¦æ­£ã—ãè¡¨ç¤º</div>';
                    test3Pass = true;
                } else {
                    document.getElementById('test3-status').innerHTML = '<div class="fail">âŒ FAIL: é–‹å‚¬ä¸­ã¨èª¤åˆ¤å®š</div>';
                }
                
            } catch (error) {
                document.getElementById('test3-status').innerHTML = `<div class="fail">âŒ ERROR: ${error.message}</div>`;
            }
        }

        async function runAllTests() {
            await test1();
            await new Promise(r => setTimeout(r, 1500));
            await test2();
            await new Promise(r => setTimeout(r, 1500));
            await test3();
            await new Promise(r => setTimeout(r, 500));
            
            const finalResult = document.getElementById('final-result');
            const finalMessage = document.getElementById('final-message');
            finalResult.style.display = 'block';
            
            if (test1Pass && test2Pass && test3Pass) {
                finalMessage.innerHTML = '<div class="pass">ğŸ‰ ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆ PASSï¼æœ¬ç•ªãƒ‡ãƒ¼ã‚¿å–å¾—æˆåŠŸï¼</div>';
            } else {
                finalMessage.innerHTML = '<div class="fail">âš ï¸ ä¸€éƒ¨ã®ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã—ã¾ã—ãŸã€‚è©³ç´°ã¯ä¸Šè¨˜ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</div>';
            }
        }

        runAllTests();
    </script>
</body>
</html>