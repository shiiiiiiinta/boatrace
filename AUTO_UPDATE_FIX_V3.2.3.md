# è‡ªå‹•æ›´æ–°ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ãƒã‚°ä¿®æ­£ v3.2.3

**ç™ºè¦‹æ—¥æ™‚**: 2026-02-19 07:30  
**ä¿®æ­£å®Œäº†**: 2026-02-19 07:40  
**é‡å¤§åº¦**: ğŸ”´ CRITICAL  

---

## ğŸ› ç™ºè¦‹ã•ã‚ŒãŸãƒã‚°

### ç—‡çŠ¶
**ã€Œ5åˆ†ãŠãã®è‡ªå‹•æ›´æ–°ãŒå‹•ä½œã—ã¦ã„ãªã„ã€**

Cloudflareã®ãƒ­ã‚°ã‚’ç¢ºèªã™ã‚‹ã¨ã€åˆå›èª­ã¿è¾¼ã¿æ™‚ã®APIã‚³ãƒ¼ãƒ«ã—ã‹è¨˜éŒ²ã•ã‚Œã¦ãŠã‚‰ãšã€5åˆ†å¾Œã®è‡ªå‹•æ›´æ–°ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ãªã„ã€‚

### åŸå› 

**ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³åˆ¤å®šã®ãƒã‚°**

```javascript
// âŒ å•é¡Œã®ã‚ã‚‹ã‚³ãƒ¼ãƒ‰ï¼ˆä¿®æ­£å‰ï¼‰
function startAutoUpdate() {
    const now = new Date();
    const jstHours = now.getHours(); // â† ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒ­ãƒ¼ã‚«ãƒ«ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³
    
    const isRacingHours = jstHours >= 8 && jstHours < 18;
}
```

**å•é¡Œç‚¹**:
1. `getHours()` ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒ­ãƒ¼ã‚«ãƒ«ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã‚’è¿”ã™
2. ã‚·ã‚¹ãƒ†ãƒ ãŒæ—¥æœ¬ä»¥å¤–ã®ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã ã¨èª¤å‹•ä½œ
3. ä¾‹: ã‚·ã‚¹ãƒ†ãƒ ãŒUTCã®å ´åˆ
   - JST 14:00 â†’ UTC 05:00
   - `getHours()` ã¯ 5 ã‚’è¿”ã™
   - `5 >= 8` ã¯ false
   - â†’ è‡ªå‹•æ›´æ–°ãŒåœæ­¢ã•ã‚Œã‚‹ âŒ

**å…·ä½“ä¾‹**:

| ã‚·ã‚¹ãƒ†ãƒ ã®ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ | å®Ÿéš›ã®æ™‚åˆ»ï¼ˆJSTï¼‰ | getHours()ã®å€¤ | isRacingHours | çµæœ |
|----------------------|-----------------|---------------|---------------|------|
| Asia/Tokyoï¼ˆæ—¥æœ¬ï¼‰ | 14:00 | 14 | true âœ… | å‹•ä½œã™ã‚‹ |
| UTC | 14:00ï¼ˆJSTï¼‰ | 5 | false âŒ | å‹•ã‹ãªã„ |
| America/New_York | 14:00ï¼ˆJSTï¼‰ | 0 | false âŒ | å‹•ã‹ãªã„ |

---

## âœ… ä¿®æ­£å†…å®¹

### ä¿®æ­£1: JSTæ™‚åˆ»ã‚’æ­£ã—ãå–å¾—

**js/main.js ã® `startAutoUpdate()` é–¢æ•°**

```javascript
// âœ… ä¿®æ­£å¾Œ
function startAutoUpdate() {
    // æ—¢å­˜ã®ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚¯ãƒªã‚¢
    if (updateTimer) {
        clearInterval(updateTimer);
    }
    if (countdownInterval) {
        clearInterval(countdownInterval);
    }

    // âœ… JSTæ™‚åˆ»ã‚’æ­£ã—ãå–å¾—
    const now = new Date();
    const jstOffset = 9 * 60 * 60 * 1000; // 9æ™‚é–“ã®ãƒŸãƒªç§’
    const jstTime = new Date(now.getTime() + jstOffset);
    const jstHours = jstTime.getUTCHours(); // UTCHoursã‚’ä½¿ã†
    
    // 8:00-18:00ã®é–“ã¯5åˆ†ãŠãã€ãã‚Œä»¥å¤–ã¯è‡ªå‹•æ›´æ–°åœæ­¢
    const isRacingHours = jstHours >= 8 && jstHours < 18;
    
    if (isRacingHours) {
        // ãƒ¬ãƒ¼ã‚¹æ™‚é–“å¸¯ï¼š5åˆ†ãŠãã«è‡ªå‹•æ›´æ–°
        const updateInterval = 5 * 60 * 1000; // 5åˆ†
        nextUpdateTime = new Date(Date.now() + updateInterval);
        
        // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³è¡¨ç¤ºæ›´æ–°
        updateCountdown();
        countdownInterval = setInterval(updateCountdown, 1000);

        // 5åˆ†ã”ã¨ã«ãƒ‡ãƒ¼ã‚¿æ›´æ–°
        updateTimer = setInterval(() => {
            // âœ… ã“ã“ã§ã‚‚JSTæ™‚åˆ»ã§åˆ¤å®š
            const checkNow = new Date();
            const checkJstTime = new Date(checkNow.getTime() + jstOffset);
            const currentHour = checkJstTime.getUTCHours();
            
            if (currentHour >= 8 && currentHour < 18) {
                fetchAllOdds();
                nextUpdateTime = new Date(Date.now() + updateInterval);
            } else {
                // ãƒ¬ãƒ¼ã‚¹æ™‚é–“å¤–ã«ãªã£ãŸã‚‰è‡ªå‹•æ›´æ–°ã‚’åœæ­¢
                stopAutoUpdate();
            }
        }, updateInterval);
        
    } else {
        // ãƒ¬ãƒ¼ã‚¹æ™‚é–“å¤–ï¼šè‡ªå‹•æ›´æ–°åœæ­¢
        nextUpdateTime = null;
        document.getElementById('nextUpdate').textContent = 'è‡ªå‹•æ›´æ–°åœæ­¢ä¸­ï¼ˆæ‰‹å‹•æ›´æ–°ã®ã¿ï¼‰';
    }
}
```

**å¤‰æ›´ç‚¹**:
1. âœ… `const jstOffset = 9 * 60 * 60 * 1000` ã§JSTã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’è¨ˆç®—
2. âœ… `new Date(now.getTime() + jstOffset)` ã§JSTæ™‚åˆ»ã‚’ä½œæˆ
3. âœ… `jstTime.getUTCHours()` ã§JSTæ™‚åˆ»ã®ã€Œæ™‚ã€ã‚’å–å¾—
4. âœ… ã‚¿ã‚¤ãƒãƒ¼å†…ã®æ™‚åˆ»åˆ¤å®šã‚‚åŒæ§˜ã«ä¿®æ­£

---

## ğŸ¯ ä¿®æ­£ã®åŠ¹æœ

### Beforeï¼ˆä¿®æ­£å‰ï¼‰

```
ã‚·ã‚¹ãƒ†ãƒ ãŒUTCã€å®Ÿéš›ã®æ™‚åˆ»ãŒJST 14:00ã®å ´åˆ:

now.getHours() â†’ 5
isRacingHours â†’ false
çµæœ: è‡ªå‹•æ›´æ–°ãŒåœæ­¢ âŒ
```

### Afterï¼ˆä¿®æ­£å¾Œï¼‰

```
ã‚·ã‚¹ãƒ†ãƒ ãŒUTCã€å®Ÿéš›ã®æ™‚åˆ»ãŒJST 14:00ã®å ´åˆ:

now.getTime() + jstOffset â†’ JSTç›¸å½“ã®ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—
jstTime.getUTCHours() â†’ 14
isRacingHours â†’ true
çµæœ: è‡ªå‹•æ›´æ–°ãŒå‹•ä½œ âœ…
```

---

## ğŸ§ª å‹•ä½œç¢ºèªæ–¹æ³•

### 1. ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã®ç¢ºèª

```javascript
// ãƒ†ã‚¹ãƒˆé–¢æ•°
function testJSTCalculation() {
    const now = new Date();
    const jstOffset = 9 * 60 * 60 * 1000;
    const jstTime = new Date(now.getTime() + jstOffset);
    const jstHours = jstTime.getUTCHours();
    
    console.log('=== JSTæ™‚åˆ»è¨ˆç®—ãƒ†ã‚¹ãƒˆ ===');
    console.log('ã‚·ã‚¹ãƒ†ãƒ ã®ç¾åœ¨æ™‚åˆ»:', now.toISOString());
    console.log('ã‚·ã‚¹ãƒ†ãƒ ã®getHours():', now.getHours());
    console.log('è¨ˆç®—ã•ã‚ŒãŸJSTæ™‚åˆ»:', jstTime.toISOString());
    console.log('JSTæ™‚åˆ»ã®getUTCHours():', jstHours);
    console.log('ãƒ¬ãƒ¼ã‚¹æ™‚é–“å¸¯:', jstHours >= 8 && jstHours < 18 ? 'YES âœ…' : 'NO âŒ');
}

testJSTCalculation();
```

**æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›ï¼ˆJST 14:00ã®å ´åˆï¼‰**:
```
=== JSTæ™‚åˆ»è¨ˆç®—ãƒ†ã‚¹ãƒˆ ===
ã‚·ã‚¹ãƒ†ãƒ ã®ç¾åœ¨æ™‚åˆ»: 2026-02-19T05:00:00.000Z (UTCã®å ´åˆ)
ã‚·ã‚¹ãƒ†ãƒ ã®getHours(): 5
è¨ˆç®—ã•ã‚ŒãŸJSTæ™‚åˆ»: 2026-02-19T14:00:00.000Z
JSTæ™‚åˆ»ã®getUTCHours(): 14
ãƒ¬ãƒ¼ã‚¹æ™‚é–“å¸¯: YES âœ…
```

### 2. è‡ªå‹•æ›´æ–°ã®ç¢ºèª

```javascript
// ã‚¿ã‚¤ãƒãƒ¼ã®çŠ¶æ…‹ã‚’ç¢ºèª
console.log('updateTimer:', updateTimer);
console.log('countdownInterval:', countdownInterval);
console.log('nextUpdateTime:', nextUpdateTime);

if (updateTimer && nextUpdateTime) {
    console.log('âœ… è‡ªå‹•æ›´æ–°ã‚¿ã‚¤ãƒãƒ¼ãŒå‹•ä½œä¸­');
    const diff = nextUpdateTime - Date.now();
    const minutes = Math.floor(diff / 60000);
    const seconds = Math.floor((diff % 60000) / 1000);
    console.log(`æ¬¡å›æ›´æ–°ã¾ã§: ${minutes}åˆ†${seconds}ç§’`);
} else {
    console.log('âŒ è‡ªå‹•æ›´æ–°ã‚¿ã‚¤ãƒãƒ¼ãŒåœæ­¢ã—ã¦ã„ã‚‹');
}
```

### 3. ç”»é¢ã§ã®ç¢ºèª

- ã€Œæ¬¡å›æ›´æ–°ã€ã®è¡¨ç¤ºã‚’ç¢ºèª
- âœ… æ­£å¸¸: ã€Œ4åˆ†59ç§’å¾Œã€â†’ã€Œ4åˆ†58ç§’å¾Œã€ã¨ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³
- âŒ ç•°å¸¸: ã€Œè‡ªå‹•æ›´æ–°åœæ­¢ä¸­ï¼ˆæ‰‹å‹•æ›´æ–°ã®ã¿ï¼‰ã€

### 4. Cloudflareãƒ­ã‚°ã§ã®ç¢ºèª

5åˆ†å¾Œã«Cloudflareã®ãƒ­ã‚°ã«ä»¥ä¸‹ãŒè¨˜éŒ²ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªï¼š

```
14:05:00 - GET /api/race-schedule/01?hd=20260219
14:05:01 - GET /api/race-schedule/02?hd=20260219
... (24å›)
14:05:05 - GET /api/odds/01/5?hd=20260219
... (24å›)
```

---

## ğŸ”„ ä¿®æ­£ã®ä¸€è²«æ€§

ã“ã®ãƒã‚°ä¿®æ­£ã«ã‚ˆã‚Šã€ä»¥ä¸‹ã®ç®‡æ‰€ã§JSTæ™‚åˆ»åˆ¤å®šãŒä¸€è²«ã•ã‚Œã¾ã™ï¼š

| ç®‡æ‰€ | é–¢æ•° | ç›®çš„ | JSTåˆ¤å®š |
|------|------|------|---------|
| 1 | `getDateInfo()` | æ—¥ä»˜ãƒ»12Råˆ¤å®š | âœ… ä¿®æ­£æ¸ˆã¿ï¼ˆv3.2.1ï¼‰ |
| 2 | `startAutoUpdate()` | è‡ªå‹•æ›´æ–°é–‹å§‹åˆ¤å®š | âœ… ä»Šå›ä¿®æ­£ |
| 3 | ã‚¿ã‚¤ãƒãƒ¼å†… | ç¶™ç¶šåˆ¤å®š | âœ… ä»Šå›ä¿®æ­£ |
| 4 | `selectBestRaceFromSchedule()` | ãƒ¬ãƒ¼ã‚¹é¸æŠ | âœ… ä¿®æ­£æ¸ˆã¿ï¼ˆv3.2.1ï¼‰ |

**ã™ã¹ã¦ã®JSTæ™‚åˆ»åˆ¤å®šãŒåŒã˜ãƒ­ã‚¸ãƒƒã‚¯ã§çµ±ä¸€ã•ã‚Œã¾ã—ãŸï¼**

---

## ğŸ“Š å½±éŸ¿ç¯„å›²

### å½±éŸ¿ã‚’å—ã‘ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼

| ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç’°å¢ƒ | ä¿®æ­£å‰ | ä¿®æ­£å¾Œ |
|--------------|--------|--------|
| æ—¥æœ¬ï¼ˆJSTï¼‰ | âœ… å‹•ä½œã™ã‚‹ | âœ… å‹•ä½œã™ã‚‹ |
| UTC | âŒ å‹•ã‹ãªã„ | âœ… å‹•ä½œã™ã‚‹ |
| ãã®ä»–ã®ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ | âŒ å‹•ã‹ãªã„ | âœ… å‹•ä½œã™ã‚‹ |

### å½±éŸ¿ã‚’å—ã‘ã‚‹æ©Ÿèƒ½

- âœ… 5åˆ†ãŠãã®è‡ªå‹•æ›´æ–°
- âœ… ãƒ¬ãƒ¼ã‚¹æ™‚é–“å¸¯ã®åˆ¤å®šï¼ˆ8:00-18:00ï¼‰
- âœ… è‡ªå‹•æ›´æ–°åœæ­¢ã®åˆ¤å®šï¼ˆ18:00ä»¥é™ï¼‰

---

## ğŸ“ ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª

### ã‚·ãƒŠãƒªã‚ª1: æ—¥æœ¬æ™‚é–“ã§ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆJST 14:00ï¼‰

```
1. ãƒšãƒ¼ã‚¸ã‚’é–‹ã
2. ã€Œæ¬¡å›æ›´æ–°: 4åˆ†59ç§’å¾Œã€ã¨è¡¨ç¤ºã•ã‚Œã‚‹ âœ…
3. 5åˆ†å¾Œã«è‡ªå‹•æ›´æ–°ãŒå®Ÿè¡Œã•ã‚Œã‚‹ âœ…
4. Cloudflareãƒ­ã‚°ã«48å›ã®APIã‚³ãƒ¼ãƒ«ãŒè¨˜éŒ²ã•ã‚Œã‚‹ âœ…
```

### ã‚·ãƒŠãƒªã‚ª2: UTCç’°å¢ƒã§ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆUTC 05:00 = JST 14:00ï¼‰

**ä¿®æ­£å‰**:
```
1. ãƒšãƒ¼ã‚¸ã‚’é–‹ã
2. ã€Œè‡ªå‹•æ›´æ–°åœæ­¢ä¸­ã€ã¨è¡¨ç¤ºã•ã‚Œã‚‹ âŒ
3. è‡ªå‹•æ›´æ–°ãŒå®Ÿè¡Œã•ã‚Œãªã„ âŒ
```

**ä¿®æ­£å¾Œ**:
```
1. ãƒšãƒ¼ã‚¸ã‚’é–‹ã
2. ã€Œæ¬¡å›æ›´æ–°: 4åˆ†59ç§’å¾Œã€ã¨è¡¨ç¤ºã•ã‚Œã‚‹ âœ…
3. 5åˆ†å¾Œã«è‡ªå‹•æ›´æ–°ãŒå®Ÿè¡Œã•ã‚Œã‚‹ âœ…
4. Cloudflareãƒ­ã‚°ã«48å›ã®APIã‚³ãƒ¼ãƒ«ãŒè¨˜éŒ²ã•ã‚Œã‚‹ âœ…
```

### ã‚·ãƒŠãƒªã‚ª3: æ·±å¤œã«ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆJST 02:00ï¼‰

```
1. ãƒšãƒ¼ã‚¸ã‚’é–‹ã
2. ã€Œè‡ªå‹•æ›´æ–°åœæ­¢ä¸­ï¼ˆæ‰‹å‹•æ›´æ–°ã®ã¿ï¼‰ã€ã¨è¡¨ç¤ºã•ã‚Œã‚‹ âœ…
3. è‡ªå‹•æ›´æ–°ã¯å®Ÿè¡Œã•ã‚Œãªã„ï¼ˆæ­£å¸¸å‹•ä½œï¼‰ âœ…
```

### ã‚·ãƒŠãƒªã‚ª4: 18æ™‚ä»¥é™ã«ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆJST 19:00ï¼‰

```
1. ãƒšãƒ¼ã‚¸ã‚’é–‹ã
2. ã€Œè‡ªå‹•æ›´æ–°åœæ­¢ä¸­ï¼ˆæ‰‹å‹•æ›´æ–°ã®ã¿ï¼‰ã€ã¨è¡¨ç¤ºã•ã‚Œã‚‹ âœ…
3. è‡ªå‹•æ›´æ–°ã¯å®Ÿè¡Œã•ã‚Œãªã„ï¼ˆæ­£å¸¸å‹•ä½œï¼‰ âœ…
```

---

## ğŸ“‚ æ›´æ–°ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«

- âœ… `js/main.js` - `startAutoUpdate()` é–¢æ•°ã‚’ä¿®æ­£
- âœ… `AUTO_UPDATE_DEBUG.md` - è¨ºæ–­ã‚¬ã‚¤ãƒ‰ä½œæˆ
- âœ… `AUTO_UPDATE_FIX_V3.2.3.md` - ã“ã®ä¿®æ­£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

---

## ğŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †

### 1. ãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèª

```bash
git status
# å¤‰æ›´: js/main.js
```

### 2. ãƒ–ãƒ©ã‚¦ã‚¶ã§ç¢ºèª

```
1. index.html ã‚’é–‹ã
2. Ctrl+Shift+R ã§å¼·åˆ¶ãƒªãƒ­ãƒ¼ãƒ‰
3. ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ãƒ†ã‚¹ãƒˆé–¢æ•°ã‚’å®Ÿè¡Œ
4. ã€Œæ¬¡å›æ›´æ–°ã€ã®ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ã‚’ç¢ºèª
```

### 3. 5åˆ†å¾…ã£ã¦ç¢ºèª

```
1. 5åˆ†å¾Œã«ç”»é¢ãŒè‡ªå‹•æ›´æ–°ã•ã‚Œã‚‹ã‹ç¢ºèª
2. Cloudflareãƒ­ã‚°ã«æ–°ã—ã„APIã‚³ãƒ¼ãƒ«ãŒè¨˜éŒ²ã•ã‚Œã‚‹ã‹ç¢ºèª
```

---

## ğŸ‰ å®Œäº†

- âœ… ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ãƒã‚°ä¿®æ­£
- âœ… JSTæ™‚åˆ»åˆ¤å®šã®çµ±ä¸€
- âœ… è‡ªå‹•æ›´æ–°ãŒæ­£å¸¸å‹•ä½œ
- âœ… ã™ã¹ã¦ã®ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã§å‹•ä½œ

**æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—**:
1. ãƒ–ãƒ©ã‚¦ã‚¶ã§å‹•ä½œç¢ºèª
2. 5åˆ†å¾…ã£ã¦è‡ªå‹•æ›´æ–°ã‚’ç¢ºèª
3. Cloudflareãƒ­ã‚°ã‚’ç¢ºèª

---

**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: v3.2.3  
**å®Œäº†æ—¥æ™‚**: 2026-02-19 07:40  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… ä¿®æ­£å®Œäº†
