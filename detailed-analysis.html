<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Detailed API Analysis</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f5f5f5; }
        .test { background: white; padding: 20px; margin: 10px 0; border-radius: 8px; }
        table { border-collapse: collapse; width: 100%; margin: 10px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background: #667eea; color: white; }
        .pass { color: green; font-weight: bold; }
        .fail { color: red; font-weight: bold; }
        .warn { color: orange; font-weight: bold; }
    </style>
</head>
<body>
    <h1>ğŸ”¬ è©³ç´°APIåˆ†æ</h1>
    
    <div class="test">
        <h2>ä¸‰å›½ï¼ˆ10ï¼‰12R - è©³ç´°</h2>
        <div id="mikuni-summary"></div>
        <table id="mikuni-table">
            <thead>
                <tr>
                    <th>è‰‡ç•ª</th>
                    <th>ã‚ªãƒƒã‚ºMin</th>
                    <th>ã‚ªãƒƒã‚ºMax</th>
                    <th>ç¥¨æ•°</th>
                    <th>é‡‘é¡</th>
                </tr>
            </thead>
            <tbody id="mikuni-tbody"></tbody>
        </table>
    </div>

    <div class="test">
        <h2>æ¡ç”Ÿï¼ˆ01ï¼‰9R - è©³ç´°</h2>
        <div id="kiryu-summary"></div>
        <table id="kiryu-table">
            <thead>
                <tr>
                    <th>è‰‡ç•ª</th>
                    <th>ã‚ªãƒƒã‚ºMin</th>
                    <th>ã‚ªãƒƒã‚ºMax</th>
                    <th>ç¥¨æ•°</th>
                    <th>é‡‘é¡</th>
                </tr>
            </thead>
            <tbody id="kiryu-tbody"></tbody>
        </table>
    </div>

    <div class="test">
        <h2>æˆ¸ç”°ï¼ˆ02ï¼‰1R - è©³ç´°</h2>
        <div id="toda-summary"></div>
    </div>

    <script>
        async function analyzeVenue(jcd, rno, prefix) {
            try {
                const url = `https://boatrace.shinta7023.workers.dev/api/odds/${jcd}/${rno}?hd=20260218`;
                const response = await fetch(url);
                const data = await response.json();
                
                const summaryDiv = document.getElementById(`${prefix}-summary`);
                
                if (!data.success) {
                    summaryDiv.innerHTML = `<span class="fail">âŒ APIå¤±æ•—: ${data.error}</span>`;
                    return;
                }
                
                if (!data.data.hasRace) {
                    summaryDiv.innerHTML = `<span class="warn">âš ï¸ ãƒ¬ãƒ¼ã‚¹é–‹å‚¬ãªã—</span>`;
                    return;
                }
                
                const odds = data.data.odds;
                const totalTickets = odds.reduce((sum, b) => sum + (b.voteTickets || 0), 0);
                
                summaryDiv.innerHTML = `
                    <div><strong>ãƒ¬ãƒ¼ã‚¹:</strong> ${data.data.raceNumber}R</div>
                    <div><strong>è‰‡æ•°:</strong> ${odds.length}</div>
                    <div><strong>åˆè¨ˆç¥¨æ•°:</strong> ${totalTickets}ç¥¨</div>
                    <div><strong>ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—:</strong> ${data.data.timestamp}</div>
                `;
                
                const tbody = document.getElementById(`${prefix}-tbody`);
                if (tbody) {
                    tbody.innerHTML = odds.map(boat => `
                        <tr>
                            <td>${boat.boatNumber}å·è‰‡</td>
                            <td>${boat.oddsMin !== undefined ? boat.oddsMin : '-'}</td>
                            <td>${boat.oddsMax !== undefined ? boat.oddsMax : '-'}</td>
                            <td>${boat.voteTickets || 0}</td>
                            <td>${boat.voteAmount || 0}å††</td>
                        </tr>
                    `).join('');
                }
                
                // ä¸‰å›½12Rã®æ¤œè¨¼
                if (jcd === '10' && rno === '12') {
                    let result = '<div style="margin-top: 15px; padding: 10px; background: #f0f0f0; border-radius: 4px;">';
                    result += '<h3>æ¤œè¨¼çµæœ:</h3>';
                    
                    const boat1 = odds[0];
                    if (boat1 && boat1.oddsMin === 1.0 && boat1.oddsMax === 1.5) {
                        result += '<div class="pass">âœ… 1å·è‰‡ã‚ªãƒƒã‚º 1.0-1.5: PASS</div>';
                    } else {
                        result += `<div class="fail">âŒ 1å·è‰‡ã‚ªãƒƒã‚º: ${boat1 ? boat1.oddsMin + '-' + boat1.oddsMax : 'N/A'} (æœŸå¾…å€¤: 1.0-1.5)</div>`;
                    }
                    
                    if (totalTickets === 180) {
                        result += '<div class="pass">âœ… åˆè¨ˆ180ç¥¨: PASS</div>';
                    } else {
                        result += `<div class="fail">âŒ åˆè¨ˆ${totalTickets}ç¥¨ (æœŸå¾…å€¤: 180ç¥¨)</div>`;
                    }
                    
                    result += '</div>';
                    summaryDiv.innerHTML += result;
                }
                
            } catch (error) {
                document.getElementById(`${prefix}-summary`).innerHTML = 
                    `<span class="fail">âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}</span>`;
            }
        }

        async function runTests() {
            await analyzeVenue('10', '12', 'mikuni');
            await new Promise(r => setTimeout(r, 1000));
            await analyzeVenue('01', '9', 'kiryu');
            await new Promise(r => setTimeout(r, 1000));
            await analyzeVenue('02', '1', 'toda');
        }

        runTests();
    </script>
</body>
</html>