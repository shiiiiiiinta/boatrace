<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é–‹å‚¬ãƒã‚§ãƒƒã‚¯ - å¹³å’Œå³¶ãƒ»å®®å³¶</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .venue-name {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success {
            background: #d4edda;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            margin: 5px;
        }
    </style>
</head>
<body>
    <h1>ğŸ” é–‹å‚¬ãƒã‚§ãƒƒã‚¯ - å¹³å’Œå³¶ãƒ»å®®å³¶</h1>
    <p><strong>ç›®çš„</strong>: 2026-02-18ï¼ˆæ˜¨æ—¥ï¼‰ã«å¹³å’Œå³¶ï¼ˆ04ï¼‰ã¨å®®å³¶ï¼ˆ17ï¼‰ãŒé–‹å‚¬ã•ã‚Œã¦ã„ãŸã‹ç¢ºèª</p>
    
    <button onclick="checkVenue('04', 'å¹³å’Œå³¶')">å¹³å’Œå³¶ï¼ˆ04ï¼‰ã‚’ãƒã‚§ãƒƒã‚¯</button>
    <button onclick="checkVenue('17', 'å®®å³¶')">å®®å³¶ï¼ˆ17ï¼‰ã‚’ãƒã‚§ãƒƒã‚¯</button>
    <button onclick="checkAllVenues()">å…¨24å ´ãƒã‚§ãƒƒã‚¯</button>
    
    <div id="results"></div>
    
    <script>
        const API_BASE_URL = 'https://boatrace.shinta7023.workers.dev';
        const TEST_DATE = '20260218'; // 2026-02-18
        
        async function checkVenue(jcd, name) {
            const resultsDiv = document.getElementById('results');
            const section = document.createElement('div');
            section.className = 'test-section';
            section.innerHTML = `<div class="venue-name">${name}ï¼ˆ${jcd}ï¼‰</div><p>ãƒã‚§ãƒƒã‚¯ä¸­...</p>`;
            resultsDiv.appendChild(section);
            
            try {
                // ãƒ¬ãƒ¼ã‚¹ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å–å¾—
                const scheduleUrl = `${API_BASE_URL}/api/race-schedule/${jcd}?hd=${TEST_DATE}`;
                console.log(`Fetching: ${scheduleUrl}`);
                
                const response = await fetch(scheduleUrl);
                const data = await response.json();
                
                console.log(`${name} schedule:`, data);
                
                let html = '';
                
                if (data.success && data.data) {
                    if (data.data.hasSchedule && data.data.races && data.data.races.length > 0) {
                        html += `<div class="result success">
                            âœ… é–‹å‚¬ã‚ã‚Šï¼ˆ${data.data.races.length}ãƒ¬ãƒ¼ã‚¹ï¼‰<br>
                            ãƒ¬ãƒ¼ã‚¹ä¸€è¦§: ${data.data.races.map(r => r.raceNumber + 'R').join(', ')}
                        </div>`;
                    } else {
                        html += `<div class="result error">
                            âŒ é–‹å‚¬ãªã—ï¼ˆhasSchedule: ${data.data.hasSchedule}ï¼‰
                        </div>`;
                    }
                } else {
                    html += `<div class="result error">
                        âŒ ã‚¨ãƒ©ãƒ¼: ${data.error || 'Unknown error'}
                    </div>`;
                }
                
                // ã‚ªãƒƒã‚ºãƒ‡ãƒ¼ã‚¿ã‚‚ç¢ºèª
                const oddsUrl = `${API_BASE_URL}/api/odds/${jcd}/1?hd=${TEST_DATE}`;
                const oddsResponse = await fetch(oddsUrl);
                const oddsData = await oddsResponse.json();
                
                if (oddsData.success && oddsData.data && oddsData.data.hasRace) {
                    html += `<div class="result success">
                        âœ… 1Rã‚ªãƒƒã‚ºãƒ‡ãƒ¼ã‚¿ã‚ã‚Š
                    </div>`;
                } else {
                    html += `<div class="result error">
                        âŒ 1Rã‚ªãƒƒã‚ºãƒ‡ãƒ¼ã‚¿ãªã—ï¼ˆhasRace: ${oddsData.data?.hasRace}ï¼‰
                    </div>`;
                }
                
                section.innerHTML = `<div class="venue-name">${name}ï¼ˆ${jcd}ï¼‰</div>` + html;
                
            } catch (error) {
                section.innerHTML = `<div class="venue-name">${name}ï¼ˆ${jcd}ï¼‰</div>
                    <div class="result error">âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
                console.error(error);
            }
        }
        
        async function checkAllVenues() {
            const venues = {
                '01': 'æ¡ç”Ÿ', '02': 'æˆ¸ç”°', '03': 'æ±Ÿæˆ¸å·', '04': 'å¹³å’Œå³¶',
                '05': 'å¤šæ‘©å·', '06': 'æµœåæ¹–', '07': 'è’²éƒ¡', '08': 'å¸¸æ»‘',
                '09': 'æ´¥', '10': 'ä¸‰å›½', '11': 'ã³ã‚ã“', '12': 'ä½ä¹‹æ±Ÿ',
                '13': 'å°¼å´', '14': 'é³´é–€', '15': 'ä¸¸äº€', '16': 'å…å³¶',
                '17': 'å®®å³¶', '18': 'å¾³å±±', '19': 'ä¸‹é–¢', '20': 'è‹¥æ¾',
                '21': 'èŠ¦å±‹', '22': 'ç¦å²¡', '23': 'å”æ´¥', '24': 'å¤§æ‘'
            };
            
            document.getElementById('results').innerHTML = '';
            
            for (const [jcd, name] of Object.entries(venues)) {
                await checkVenue(jcd, name);
                await new Promise(resolve => setTimeout(resolve, 500)); // 0.5ç§’å¾…æ©Ÿ
            }
        }
    </script>
</body>
</html>
