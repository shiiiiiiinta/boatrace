# ğŸ”§ ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚¨ãƒ©ãƒ¼ä¿®æ­£ã‚¬ã‚¤ãƒ‰

## âŒ ã‚¨ãƒ©ãƒ¼å†…å®¹

```json
{
  "success": false,
  "error": "Failed to send email alert: Unexpected token '<', ..."
}
```

### åŸå› 
Google Apps Script ã®Webhook URLãŒHTMLã‚’è¿”ã—ã¦ã„ã‚‹
â†’ ãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®šã§ã€Œã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã€ãŒã€Œå…¨å“¡ã€ã«ãªã£ã¦ã„ãªã„

---

## âœ… ä¿®æ­£æ‰‹é †

### ã‚¹ãƒ†ãƒƒãƒ—1: Google Apps Script ã®ãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®šã‚’ç¢ºèª

1. https://script.google.com/ ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é–‹ã
3. ã€Œãƒ‡ãƒ—ãƒ­ã‚¤ã€â†’ã€Œãƒ‡ãƒ—ãƒ­ã‚¤ã‚’ç®¡ç†ã€
4. ç¾åœ¨ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã®ã€Œç·¨é›†ã€ï¼ˆé‰›ç­†ã‚¢ã‚¤ã‚³ãƒ³ï¼‰
5. **ã€Œã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã€ã‚’ç¢ºèª**
   - âŒ `è‡ªåˆ†ã®ã¿` â†’ ã“ã‚ŒãŒåŸå› 
   - âœ… `å…¨å“¡` â†’ æ­£ã—ã„è¨­å®š

### ã‚¹ãƒ†ãƒƒãƒ—2: è¨­å®šã‚’ä¿®æ­£

1. ã€Œã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã€ã‚’ **`å…¨å“¡`** ã«å¤‰æ›´
2. ã€Œãƒãƒ¼ã‚¸ãƒ§ãƒ³ã€ã‚’ã€Œæ–°ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã€ã«å¤‰æ›´
3. ã€Œãƒ‡ãƒ—ãƒ­ã‚¤ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
4. **æ–°ã—ã„Webhook URL** ãŒè¡¨ç¤ºã•ã‚Œã‚‹
5. URLã‚’ã‚³ãƒ”ãƒ¼

---

## ğŸ”„ Worker ã®Webhook URLã‚’æ›´æ–°

### worker.js ã‚’ä¿®æ­£

`worker.js` ã®ç´„434è¡Œç›®ï¼š

```javascript
// å¤ã„URLï¼ˆå¤‰æ›´å‰ï¼‰
const WEBHOOK_URL = 'https://script.google.com/macros/s/AKfycbxha5zinYQ94p3FbEYVbS6EZJr4CRV1MFpKg4vcQyfcq_LDXkfNOACIV_evicx36y7n/exec';

// æ–°ã—ã„URLï¼ˆå–å¾—ã—ãŸURLã«å¤‰æ›´ï¼‰
const WEBHOOK_URL = 'ã‚ãªãŸã®æ–°ã—ã„Webhook URL';
```

### Worker ã‚’å†ãƒ‡ãƒ—ãƒ­ã‚¤

1. Cloudflare Dashboard â†’ Workers & Pages â†’ `boatrace`
2. Edit code
3. Webhook URLã‚’æ–°ã—ã„URLã«å¤‰æ›´
4. Save and Deploy

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆ

### ãƒ–ãƒ©ã‚¦ã‚¶ã§Webhook URLã‚’ç›´æ¥é–‹ã

æ–°ã—ã„URLã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã„ã¦ã€ä»¥ä¸‹ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‹ç¢ºèªï¼š

```json
{
  "status": "ok",
  "message": "Boatrace High Odds Alert Webhook",
  "endpoint": "POST only",
  ...
}
```

### test-email-alert.html ã§å†ãƒ†ã‚¹ãƒˆ

1. `test-email-alert.html` ã‚’é–‹ã
2. ã€ŒğŸš€ ãƒ†ã‚¹ãƒˆãƒ¡ãƒ¼ãƒ«é€ä¿¡ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
3. æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‹ç¢ºèª
4. `shinta7023@gmail.com` ã«ãƒ¡ãƒ¼ãƒ«ãŒå±Šãã‹ç¢ºèª

---

## ğŸ” ãƒ‡ãƒãƒƒã‚°æ–¹æ³•

### Worker ã®ãƒ­ã‚°ã‚’ç¢ºèª

1. Cloudflare Dashboard â†’ Workers â†’ `boatrace` â†’ Logs
2. `[ALERT]` ã§å§‹ã¾ã‚‹ãƒ­ã‚°ã‚’æ¢ã™
3. ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèª

### Google Apps Script ã®ãƒ­ã‚°ã‚’ç¢ºèª

1. https://script.google.com/
2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é–‹ã
3. å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã€Œå®Ÿè¡Œæ•°ã€
4. ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚Œã°è©³ç´°ã‚’ç¢ºèª

---

## ğŸ’¡ ç¢ºèªãƒã‚¤ãƒ³ãƒˆ

### Google Apps Script å´

- [ ] ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå®Œäº†ã—ã¦ã„ã‚‹
- [ ] ã€Œã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã€ãŒã€Œå…¨å“¡ã€ã«ãªã£ã¦ã„ã‚‹
- [ ] Webhook URLã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ãã¨JSONãŒè¿”ã‚‹

### Worker å´

- [ ] Webhook URLãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] Worker ãŒå†ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒ `2.2.0-with-schedule` ä»¥é™

---

## ğŸ“ æ–°ã—ã„Webhook URLã®å ±å‘Š

æ–°ã—ã„Webhook URLã‚’å–å¾—ã—ãŸã‚‰ã€ä»¥ä¸‹ã®å½¢å¼ã§å ±å‘Šã—ã¦ãã ã•ã„ï¼š

```
æ–°ã—ã„Webhook URL: https://script.google.com/macros/s/XXXXX.../exec
```

ãã®å¾Œã€Worker ã‚’æ›´æ–°ã—ã¾ã™ã€‚

---

**ã¾ãšã€Google Apps Script ã®ãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼**
