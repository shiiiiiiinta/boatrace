<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Webhook ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        pre { background: #f5f5f5; padding: 15px; border-radius: 5px; overflow-x: auto; }
        button { padding: 10px 20px; margin: 10px 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>ğŸ“§ Google Apps Script Webhook ãƒ†ã‚¹ãƒˆ</h1>
    
    <h3>ç¾åœ¨ã®Webhook URL</h3>
    <pre>https://script.google.com/macros/s/AKfycbxha5zinYQ94p3FbEYVbS6EZJr4CRV1MFpKg4vcQyfcq_LDXkfNOACIV_evicx36y7n/exec</pre>
    
    <h3>ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</h3>
    <button onclick="testDirect()">1. ç›´æ¥Webhookã‚’ãƒ†ã‚¹ãƒˆ</button>
    <button onclick="testViaWorker()">2. WorkerçµŒç”±ã§ãƒ†ã‚¹ãƒˆ</button>
    
    <h3>çµæœ</h3>
    <pre id="result">ã¾ã å®Ÿè¡Œã•ã‚Œã¦ã„ã¾ã›ã‚“</pre>

    <script>
        const WEBHOOK_URL = 'https://script.google.com/macros/s/AKfycbxha5zinYQ94p3FbEYVbS6EZJr4CRV1MFpKg4vcQyfcq_LDXkfNOACIV_evicx36y7n/exec';
        const WORKER_URL = 'https://boatrace.shinta7023.workers.dev/api/send-alert';
        
        async function testDirect() {
            const result = document.getElementById('result');
            result.textContent = 'ç›´æ¥ãƒ†ã‚¹ãƒˆä¸­...\n';
            
            try {
                const testData = {
                    alerts: [
                        { venue: 'ãƒ†ã‚¹ãƒˆä¼šå ´', jcd: '01', race: 8, odds: '5.2-6.8' }
                    ],
                    timestamp: new Date().toISOString()
                };
                
                result.textContent += `é€ä¿¡ãƒ‡ãƒ¼ã‚¿:\n${JSON.stringify(testData, null, 2)}\n\n`;
                
                const response = await fetch(WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(testData)
                });
                
                result.textContent += `Status: ${response.status} ${response.statusText}\n`;
                result.textContent += `Content-Type: ${response.headers.get('content-type')}\n\n`;
                
                const text = await response.text();
                result.textContent += `ãƒ¬ã‚¹ãƒãƒ³ã‚¹:\n${text}\n\n`;
                
                // JSONã¨ã—ã¦ãƒ‘ãƒ¼ã‚¹ã‚’è©¦ã¿ã‚‹
                try {
                    const json = JSON.parse(text);
                    result.textContent += `JSONè§£ææˆåŠŸ:\n${JSON.stringify(json, null, 2)}`;
                    
                    if (json.success) {
                        alert('âœ… ç›´æ¥Webhookãƒ†ã‚¹ãƒˆæˆåŠŸï¼ãƒ¡ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„');
                    } else {
                        alert('âš ï¸ Webhookã¯ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã—ã¾ã—ãŸãŒã€success=false');
                    }
                } catch (e) {
                    result.textContent += `âŒ JSONè§£æå¤±æ•—: ${e.message}\n`;
                    result.textContent += `ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒHTMLã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚`;
                    alert('âŒ WebhookãŒHTMLã‚’è¿”ã—ã¦ã„ã¾ã™ã€‚Google Apps Scriptã®ãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
                }
                
            } catch (error) {
                result.textContent += `\nâŒ ã‚¨ãƒ©ãƒ¼: ${error.message}\n${error.stack}`;
            }
        }
        
        async function testViaWorker() {
            const result = document.getElementById('result');
            result.textContent = 'WorkerçµŒç”±ãƒ†ã‚¹ãƒˆä¸­...\n';
            
            try {
                const testData = {
                    alerts: [
                        { venue: 'ãƒ†ã‚¹ãƒˆä¼šå ´', jcd: '01', race: 8, odds: '5.2-6.8' }
                    ]
                };
                
                result.textContent += `é€ä¿¡ãƒ‡ãƒ¼ã‚¿:\n${JSON.stringify(testData, null, 2)}\n\n`;
                
                const response = await fetch(WORKER_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(testData)
                });
                
                result.textContent += `Status: ${response.status} ${response.statusText}\n\n`;
                
                const data = await response.json();
                result.textContent += `ãƒ¬ã‚¹ãƒãƒ³ã‚¹:\n${JSON.stringify(data, null, 2)}`;
                
                if (data.success && data.data.emailSent) {
                    alert('âœ… WorkerçµŒç”±ãƒ†ã‚¹ãƒˆæˆåŠŸï¼ãƒ¡ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„');
                } else {
                    alert('âŒ ãƒ¡ãƒ¼ãƒ«é€ä¿¡å¤±æ•—');
                }
                
            } catch (error) {
                result.textContent += `\nâŒ ã‚¨ãƒ©ãƒ¼: ${error.message}\n${error.stack}`;
            }
        }
    </script>
</body>
</html>
