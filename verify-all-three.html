<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3æ¡ä»¶æœ€çµ‚æ¤œè¨¼</title>
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
        }
        .check-item {
            background: white;
            padding: 25px;
            margin: 15px 0;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .check-item h2 {
            margin-top: 0;
            color: #333;
        }
        .status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            margin-left: 10px;
        }
        .status.pending { background: #ffc107; color: white; }
        .status.checking { background: #2196F3; color: white; }
        .status.success { background: #4CAF50; color: white; }
        .status.failed { background: #f44336; color: white; }
        .details {
            margin-top: 15px;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        .final-result {
            background: white;
            padding: 30px;
            margin-top: 30px;
            border-radius: 10px;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
        }
        .final-result.success {
            border: 5px solid #4CAF50;
            color: #4CAF50;
        }
        .final-result.failed {
            border: 5px solid #f44336;
            color: #f44336;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” æœ€çµ‚æ¤œè¨¼: 3æ¡ä»¶ãƒã‚§ãƒƒã‚¯</h1>
        
        <div class="check-item" id="check1">
            <h2>
                1ï¸âƒ£ ä¸‰å›½12R ç·æŠ•ç¥¨æ•°180ç¥¨
                <span class="status pending">å¾…æ©Ÿä¸­</span>
            </h2>
            <div class="details" id="details1">æ¤œè¨¼é–‹å§‹å‰...</div>
        </div>

        <div class="check-item" id="check2">
            <h2>
                2ï¸âƒ£ ä¸‰å›½12R 1å·è‰‡ã‚ªãƒƒã‚º1.0-1.5
                <span class="status pending">å¾…æ©Ÿä¸­</span>
            </h2>
            <div class="details" id="details2">æ¤œè¨¼é–‹å§‹å‰...</div>
        </div>

        <div class="check-item" id="check3">
            <h2>
                3ï¸âƒ£ æˆ¸ç”°ãƒ»å¹³å’Œå³¶ éé–‹å‚¬è¡¨ç¤º
                <span class="status pending">å¾…æ©Ÿä¸­</span>
            </h2>
            <div class="details" id="details3">æ¤œè¨¼é–‹å§‹å‰...</div>
        </div>

        <div class="final-result" id="finalResult" style="display: none;">
            æ¤œè¨¼ä¸­...
        </div>
    </div>

    <script>
        const checks = {
            check1: false,
            check2: false,
            check3: false
        };

        function updateStatus(checkId, status, details) {
            const checkItem = document.getElementById(checkId);
            const statusEl = checkItem.querySelector('.status');
            const detailsEl = document.getElementById(`details${checkId.slice(-1)}`);
            
            statusEl.className = `status ${status}`;
            statusEl.textContent = {
                'pending': 'å¾…æ©Ÿä¸­',
                'checking': 'æ¤œè¨¼ä¸­...',
                'success': 'âœ… åˆæ ¼',
                'failed': 'âŒ ä¸åˆæ ¼'
            }[status];
            
            detailsEl.innerHTML = details;
        }

        async function check1_MikuniVotes() {
            updateStatus('check1', 'checking', 'ä¸‰å›½12Rã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ä¸­...');
            
            try {
                const response = await fetch('https://boatrace.shinta7023.workers.dev/api/odds/10/12?hd=20260218');
                const data = await response.json();
                
                console.log('ä¸‰å›½12R ãƒ¬ã‚¹ãƒãƒ³ã‚¹:', data);
                
                // Worker ã¯ {success: true, data: {...}} ã¨ã„ã†æ§‹é€ ã§è¿”ã™
                const responseData = data.data || data;
                
                if (!responseData.hasRace || !responseData.odds) {
                    updateStatus('check1', 'failed', `âŒ ãƒ¬ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿ãªã—<br>hasRace: ${responseData.hasRace}<br>odds: ${responseData.odds}`);
                    return false;
                }
                
                const totalVotes = responseData.odds.reduce((sum, boat) => sum + (boat.voteTickets || 0), 0);
                const breakdown = responseData.odds.map(b => `${b.boatNumber}å·è‰‡: ${b.voteTickets || 0}ç¥¨`).join('<br>');
                
                if (totalVotes === 180) {
                    updateStatus('check1', 'success', `âœ… ç·æŠ•ç¥¨æ•°: ${totalVotes}ç¥¨<br><br>å†…è¨³:<br>${breakdown}`);
                    checks.check1 = true;
                    return true;
                } else {
                    updateStatus('check1', 'failed', `âŒ ç·æŠ•ç¥¨æ•°ä¸ä¸€è‡´<br>å–å¾—å€¤: ${totalVotes}ç¥¨<br>æœŸå¾…å€¤: 180ç¥¨<br><br>å†…è¨³:<br>${breakdown}`);
                    return false;
                }
            } catch (error) {
                updateStatus('check1', 'failed', `âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                console.error('Check1 error:', error);
                return false;
            }
        }

        async function check2_MikuniOdds() {
            updateStatus('check2', 'checking', 'ä¸‰å›½12R 1å·è‰‡ã‚ªãƒƒã‚ºã‚’ç¢ºèªä¸­...');
            
            try {
                const response = await fetch('https://boatrace.shinta7023.workers.dev/api/odds/10/12?hd=20260218');
                const data = await response.json();
                
                // Worker ã¯ {success: true, data: {...}} ã¨ã„ã†æ§‹é€ ã§è¿”ã™
                const responseData = data.data || data;
                
                console.log('ä¸‰å›½12R 1å·è‰‡ã‚ªãƒƒã‚º:', responseData.odds);
                
                if (!responseData.hasRace || !responseData.odds) {
                    updateStatus('check2', 'failed', 'âŒ ãƒ¬ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿ãªã—');
                    return false;
                }
                
                const boat1 = responseData.odds.find(b => b.boatNumber === 1);
                
                if (!boat1) {
                    updateStatus('check2', 'failed', 'âŒ 1å·è‰‡ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    return false;
                }
                
                const oddsMatch = boat1.oddsMin === 1.0 && boat1.oddsMax === 1.5;
                
                if (oddsMatch) {
                    updateStatus('check2', 'success', `âœ… ã‚ªãƒƒã‚ºä¸€è‡´<br>å–å¾—å€¤: ${boat1.oddsMin} - ${boat1.oddsMax}<br>æœŸå¾…å€¤: 1.0 - 1.5`);
                    checks.check2 = true;
                    return true;
                } else {
                    updateStatus('check2', 'failed', `âŒ ã‚ªãƒƒã‚ºä¸ä¸€è‡´<br>å–å¾—å€¤: ${boat1.oddsMin} - ${boat1.oddsMax}<br>æœŸå¾…å€¤: 1.0 - 1.5`);
                    return false;
                }
            } catch (error) {
                updateStatus('check2', 'failed', `âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                console.error('Check2 error:', error);
                return false;
            }
        }

        async function check3_NoRaceVenues() {
            updateStatus('check3', 'checking', 'æˆ¸ç”°ãƒ»å¹³å’Œå³¶ã®é–‹å‚¬çŠ¶æ³ã‚’ç¢ºèªä¸­...');
            
            try {
                // æˆ¸ç”°=02, å¹³å’Œå³¶=04
                const todaResponse = await fetch('https://boatrace.shinta7023.workers.dev/api/odds/02/1?hd=20260218');
                const todaData = await todaResponse.json();
                
                const heiwajimaResponse = await fetch('https://boatrace.shinta7023.workers.dev/api/odds/04/1?hd=20260218');
                const heiwajimaData = await heiwajimaResponse.json();
                
                // Worker ã¯ {success: true, data: {...}} ã¨ã„ã†æ§‹é€ ã§è¿”ã™
                const todaResponseData = todaData.data || todaData;
                const heiwajimaResponseData = heiwajimaData.data || heiwajimaData;
                
                console.log('æˆ¸ç”°:', todaResponseData);
                console.log('å¹³å’Œå³¶:', heiwajimaResponseData);
                
                const todaNoRace = todaResponseData.hasRace === false;
                const heiwajimaNoRace = heiwajimaResponseData.hasRace === false;
                
                if (todaNoRace && heiwajimaNoRace) {
                    updateStatus('check3', 'success', 
                        `âœ… ä¸¡å ´ã¨ã‚‚éé–‹å‚¬ã‚’æ­£ã—ãè¿”å´<br><br>` +
                        `æˆ¸ç”°: hasRace = ${todaResponseData.hasRace}<br>` +
                        `å¹³å’Œå³¶: hasRace = ${heiwajimaResponseData.hasRace}`
                    );
                    checks.check3 = true;
                    return true;
                } else {
                    updateStatus('check3', 'failed', 
                        `âŒ éé–‹å‚¬ãŒæ­£ã—ãåˆ¤å®šã•ã‚Œã¦ã„ã¾ã›ã‚“<br><br>` +
                        `æˆ¸ç”°: hasRace = ${todaResponseData.hasRace} (æœŸå¾…: false)<br>` +
                        `å¹³å’Œå³¶: hasRace = ${heiwajimaResponseData.hasRace} (æœŸå¾…: false)`
                    );
                    return false;
                }
            } catch (error) {
                updateStatus('check3', 'failed', `âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                console.error('Check3 error:', error);
                return false;
            }
        }

        async function runAllChecks() {
            console.log('=== æœ€çµ‚æ¤œè¨¼é–‹å§‹ ===');
            
            await check1_MikuniVotes();
            await new Promise(r => setTimeout(r, 500));
            
            await check2_MikuniOdds();
            await new Promise(r => setTimeout(r, 500));
            
            await check3_NoRaceVenues();
            await new Promise(r => setTimeout(r, 500));
            
            // æœ€çµ‚åˆ¤å®š
            const finalResult = document.getElementById('finalResult');
            finalResult.style.display = 'block';
            
            if (checks.check1 && checks.check2 && checks.check3) {
                finalResult.className = 'final-result success';
                finalResult.innerHTML = 'ğŸ‰ å…¨ã¦ã®æ¤œè¨¼ã«åˆæ ¼ã—ã¾ã—ãŸï¼<br><br>æœ¬ç•ªãƒ‡ãƒ¼ã‚¿ã®å–å¾—ãƒ»è¡¨ç¤ºãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™';
                console.log('âœ… å…¨ãƒã‚§ãƒƒã‚¯åˆæ ¼ï¼');
            } else {
                finalResult.className = 'final-result failed';
                const failedChecks = [];
                if (!checks.check1) failedChecks.push('ä¸‰å›½12R ç·æŠ•ç¥¨æ•°');
                if (!checks.check2) failedChecks.push('ä¸‰å›½12R 1å·è‰‡ã‚ªãƒƒã‚º');
                if (!checks.check3) failedChecks.push('æˆ¸ç”°ãƒ»å¹³å’Œå³¶ éé–‹å‚¬');
                
                finalResult.innerHTML = `âŒ æ¤œè¨¼ä¸åˆæ ¼<br><br>å¤±æ•—ã—ãŸé …ç›®:<br>${failedChecks.join('<br>')}`;
                console.log('âŒ æ¤œè¨¼ä¸åˆæ ¼:', failedChecks);
            }
        }

        // å®Ÿè¡Œ
        runAllChecks();
    </script>
</body>
</html>
