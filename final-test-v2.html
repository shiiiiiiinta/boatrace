<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœ€çµ‚ç¢ºèªãƒ†ã‚¹ãƒˆ v2</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .venue {
            margin: 10px 0;
            padding: 10px;
            border-left: 4px solid #007bff;
            background: #f8f9fa;
        }
        .success { border-left-color: #28a745; background: #d4edda; }
        .error { border-left-color: #dc3545; background: #f8d7da; }
        .warning { border-left-color: #ffc107; background: #fff3cd; }
        button {
            padding: 10px 20px;
            margin: 5px;
            font-size: 14px;
            cursor: pointer;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
        }
        button:hover { background: #0056b3; }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>ğŸ” æœ€çµ‚ç¢ºèªãƒ†ã‚¹ãƒˆ v2</h1>
    <p><strong>æ—¥ä»˜</strong>: 2026-02-18ï¼ˆæ˜¨æ—¥ï¼‰</p>
    <p><strong>API</strong>: https://boatrace.shinta7023.workers.dev</p>
    
    <div class="section">
        <h2>Step 1: å•é¡Œã®å ´ã‚’å€‹åˆ¥ãƒ†ã‚¹ãƒˆ</h2>
        <button onclick="testVenue('04', 'å¹³å’Œå³¶')">å¹³å’Œå³¶ï¼ˆ04ï¼‰</button>
        <button onclick="testVenue('17', 'å®®å³¶')">å®®å³¶ï¼ˆ17ï¼‰</button>
        <button onclick="testVenue('20', 'è‹¥æ¾')">è‹¥æ¾ï¼ˆ20ï¼‰</button>
        <button onclick="testVenue('10', 'ä¸‰å›½')">ä¸‰å›½ï¼ˆ10ï¼‰</button>
        <button onclick="testVenue('01', 'æ¡ç”Ÿ')">æ¡ç”Ÿï¼ˆ01ï¼‰</button>
    </div>
    
    <div class="section">
        <h2>Step 2: å…¨24å ´ãƒ†ã‚¹ãƒˆ</h2>
        <button onclick="testAllVenues()">å…¨24å ´ã‚’ä¸€æ‹¬ãƒ†ã‚¹ãƒˆ</button>
        <button onclick="clearResults()">çµæœã‚¯ãƒªã‚¢</button>
    </div>
    
    <div id="results"></div>
    
    <script>
        const API_BASE = 'https://boatrace.shinta7023.workers.dev';
        const TEST_DATE = '20260218';
        
        const VENUES = {
            '01': 'æ¡ç”Ÿ', '02': 'æˆ¸ç”°', '03': 'æ±Ÿæˆ¸å·', '04': 'å¹³å’Œå³¶',
            '05': 'å¤šæ‘©å·', '06': 'æµœåæ¹–', '07': 'è’²éƒ¡', '08': 'å¸¸æ»‘',
            '09': 'æ´¥', '10': 'ä¸‰å›½', '11': 'ã³ã‚ã“', '12': 'ä½ä¹‹æ±Ÿ',
            '13': 'å°¼å´', '14': 'é³´é–€', '15': 'ä¸¸äº€', '16': 'å…å³¶',
            '17': 'å®®å³¶', '18': 'å¾³å±±', '19': 'ä¸‹é–¢', '20': 'è‹¥æ¾',
            '21': 'èŠ¦å±‹', '22': 'ç¦å²¡', '23': 'å”æ´¥', '24': 'å¤§æ‘'
        };
        
        async function testVenue(jcd, name) {
            const resultsDiv = document.getElementById('results');
            const venueDiv = document.createElement('div');
            venueDiv.className = 'section';
            venueDiv.innerHTML = `<h3>${name}ï¼ˆ${jcd}ï¼‰</h3><p>ãƒ†ã‚¹ãƒˆä¸­...</p>`;
            resultsDiv.appendChild(venueDiv);
            
            try {
                // Step 1: ãƒ¬ãƒ¼ã‚¹ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å–å¾—
                const scheduleUrl = `${API_BASE}/api/race-schedule/${jcd}?hd=${TEST_DATE}`;
                console.log(`Fetching: ${scheduleUrl}`);
                const scheduleRes = await fetch(scheduleUrl);
                const scheduleData = await scheduleRes.json();
                
                let html = `<h3>${name}ï¼ˆ${jcd}ï¼‰</h3>`;
                
                // ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«çµæœ
                html += `<div class="venue ${scheduleData.success && scheduleData.data.hasSchedule ? 'success' : 'warning'}">`;
                html += `<strong>ğŸ“… ãƒ¬ãƒ¼ã‚¹ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</strong><br>`;
                html += `URL: <code>${scheduleUrl}</code><br>`;
                html += `success: ${scheduleData.success}<br>`;
                html += `hasSchedule: ${scheduleData.data?.hasSchedule}<br>`;
                
                if (scheduleData.data?.hasSchedule && scheduleData.data.races) {
                    html += `ãƒ¬ãƒ¼ã‚¹æ•°: ${scheduleData.data.races.length}<br>`;
                    const raceList = scheduleData.data.races.map(r => `${r.raceNumber}R(${r.limitTime})`).join(', ');
                    html += `ãƒ¬ãƒ¼ã‚¹ä¸€è¦§: ${raceList}<br>`;
                    html += `</div>`;
                    
                    // Step 2: 12Rã®ã‚ªãƒƒã‚ºå–å¾—
                    const oddsUrl = `${API_BASE}/api/odds/${jcd}/12?hd=${TEST_DATE}`;
                    console.log(`Fetching: ${oddsUrl}`);
                    const oddsRes = await fetch(oddsUrl);
                    const oddsData = await oddsRes.json();
                    
                    html += `<div class="venue ${oddsData.success && oddsData.data.hasRace ? 'success' : 'error'}">`;
                    html += `<strong>ğŸ¯ 12Rã‚ªãƒƒã‚º</strong><br>`;
                    html += `URL: <code>${oddsUrl}</code><br>`;
                    html += `success: ${oddsData.success}<br>`;
                    html += `hasRace: ${oddsData.data?.hasRace}<br>`;
                    
                    if (oddsData.data?.hasRace && oddsData.data.odds) {
                        html += `ã‚ªãƒƒã‚ºæ•°: ${oddsData.data.odds.length}<br>`;
                        html += `1å·è‰‡: ${oddsData.data.odds[0].oddsMin}ã€œ${oddsData.data.odds[0].oddsMax}<br>`;
                        html += `<details><summary>è©³ç´°ãƒ‡ãƒ¼ã‚¿</summary><pre>${JSON.stringify(oddsData.data.odds, null, 2)}</pre></details>`;
                    } else {
                        html += `<span style="color: red;">âŒ ã‚ªãƒƒã‚ºãƒ‡ãƒ¼ã‚¿ãªã—</span><br>`;
                        html += `<pre>${JSON.stringify(oddsData, null, 2)}</pre>`;
                    }
                    html += `</div>`;
                    
                } else {
                    html += `<span style="color: orange;">âš ï¸ é–‹å‚¬ãªã—</span>`;
                    html += `</div>`;
                }
                
                venueDiv.innerHTML = html;
                
            } catch (error) {
                venueDiv.innerHTML = `<h3>${name}ï¼ˆ${jcd}ï¼‰</h3>
                    <div class="venue error">âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}<br>
                    <pre>${error.stack}</pre></div>`;
                console.error(error);
            }
        }
        
        async function testAllVenues() {
            clearResults();
            const summary = {};
            
            for (const [jcd, name] of Object.entries(VENUES)) {
                await testVenue(jcd, name);
                await new Promise(r => setTimeout(r, 500)); // 0.5ç§’å¾…æ©Ÿ
            }
        }
        
        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }
    </script>
</body>
</html>
